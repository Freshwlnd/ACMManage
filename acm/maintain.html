<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>信息维护</title>
    <link rel="stylesheet" type="text/css" href="../themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../demo.css">
    <script type="text/javascript" src="../jquery.min.js"></script>
    <script type="text/javascript" src="../jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../jquery.easyui.mobile.js"></script>
    <script type="text/javascript" src="../../jquery.easyui.easyloader.js"></script>
</head>
<body style="background-color:azure">



<div id="panelC" class="easyui-panel" style="background-color:azure;">

</div>
<div id="panelC1" class="easyui-panel" style="background-color:antiquewhite;">

</div>
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br />
<div style="margin:15px 400px"><a id="buttonChange" class="easyui-linkbutton">修改信息</a></div>




<script>
    //初始化样式
    $('#panelP').panel({
        width: 1510,
        height: 738,
    });
    $('#panelC').panel({
        width: 350,
        height: 450,
        left: 300,
        top:180,
        style: {
            'position':'absolute'
        }
    });
    $('#panelC1').panel({
        width: 700,
        height: 450,
        left: 700,
        top: 180,
        style: {
            'position': 'absolute'
        }
    });
    $('#buttonChange').linkbutton({
        width:100,
    });
    function disp(num) {
        var re = "";
        for (var x = 0; x < num; ++x) {
            re += "&nbsp";
        }
        return re;
    }
    //获取本人信息
    function getInfo() {
        //获取基本信息
        var result;
        $.ajax({
            type: "post",
            async: false,
            url: './GetOneselfData.php',
            success: function (data) {
                result = data;
            }
        });
        result = JSON.parse(result);
        for(let i in result){
            if(result[i]===null){
                result[i]='';
            }
        }
        var title = $("<div style='margin: 15px 100px'>"+"学号: " + disp(4)+ result.PNo + "</div>" +
            "<div style='margin: 15px 100px'>" + "姓名: " + disp(4) + result.PName + "</div>" +
            "<div style='margin: 15px 100px'>" + "性别: " + disp(4) + result.PSex + "</div>" +
            "<div style='margin: 15px 100px'>" + "班级: " + disp(4) + result.PClass + "</div>" +
            "<div style='margin: 15px 72px'>" + "电话号码: " + disp(4) + result.PPhone + "</div>" +
            "<div style='margin: 15px 91px'>" + "QQ号: " + disp(4) + result.PQQ + "</div>" +
            "<div style='margin: 15px 86px'>" + "微信号: " + disp(4) + result.PWechat + "</div>" +
            "<div style='margin: 15px 72px'>" + "银行卡号: " + disp(4) + result.PBankNo + "</div>" +
            "<div style='margin: 15px 72px'>" + "T-恤尺码: " + disp(4) + result.PT_Size + "</div>" +
            "<div style='margin: 15px 72px'>" + "杭电账号: " + disp(4) + result.PHdu + "</div>" +
            "<div style='margin: 15px 100px'>" + "座位: " + disp(4) + result.PSeatNo + "</div>")
        $('#panelC').panel('clear');
        $('#panelC').append(title);
        $('#panelC').show();
    }
    //获取奖牌信息

    $(function () {
        var result;
        var title;
        $.ajax({
            type: "post",
            async: false,
            url: './GetOneselfAward.php',
            success: function (data) {
                result = data;
            }
        });
        result = JSON.parse(result);
        if(result['error']!=null) {
            title = result['error'];
        } else {
            title = "";
            for (var i in result) {
                title = title + ("<center><div>" + disp(4) + result[i]['比赛时间'] + "参加了在"
                    + result[i]['比赛地点'] + "举办的大学生程序设计竞赛"
                    + result[i]['比赛名'] + "获得了"
                    + result[i]['获奖情况']
                    + "，参赛队员有：" + "</div></center>" + "<center><div>" + disp(4) + result[i]['队员1'] + disp(5)
                    + result[i]['队员2'] + disp(5)
                    + result[i]['队员3'] + "</div></center>" + "<br/>");
            }
        }
        $('#panelC1').panel('clear');
        $('#panelC1').append(title);
        $('#panelC1').show();
    });
    //修改文本框样式
    function changeCSS(mInfo) {
        var css = {
            width: 220,
            label: '班级: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PClass,
        }
        $('#PClass').textbox(css);
        css = {
            width: 220,
            label: '银行卡号: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PBankNo,
        }
        $('#PBankNo').textbox(css);
        css = {
            width: 220,
            label: '电话号码: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PPhone,
        }
        $('#PPhone').textbox(css);
        css = {
            width: 220,
            label: 'QQ: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PQQ,
        }
        $('#PQQ').textbox(css);
        css = {
            width: 220,
            label: '微信: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PWechat,
        }
        $('#PWechat').textbox(css);
        css = {
            width: 220,
            label: 'T-恤尺码: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PT_Size,
        }
        $('#PT_Size').textbox(css);
        css = {
            width: 220,
            label: '杭电账号: ',
            labelposition: 'left',
            labelAlign: 'right',
            prompt: mInfo.PHdu,
        }
        $('#PHdu').textbox(css);
        css = {
            disabled:false,
        }
        $('#buttonConfire').linkbutton(css);
        $('#panelC').show();
    }

    //修改信息
    $('#buttonChange').click(function () {
        var result;
        $.ajax({
            type: "post",
            async: false,
            url: './GetOneselfData.php',
            success: function (data) {
                result = data;
            }
        });
        $('#panelC').panel('clear');
        result = JSON.parse(result);
        var title = ("<div style='margin: 17px 45px;'><input id='PClass' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PBankNo' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PPhone' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PQQ' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PWechat' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PT_Size' class='easyui-textbox' \/></div>" +
            "<div style='margin: 20px 45px;'><input id='PHdu' class='easyui-textbox' \/></div>" +
            "<div><center><a id='buttonConfire' class='easyui - linkbutton'>确认修改</a></center></div>");

        $('#panelC').append(title);
        $('#panelC').show();
        changeCSS(result);
        $('#buttonConfire').click(
            //按下确认修改
            function ChangeInfo() {
                //修改完成返回数据,未填写返回原数据
                var PName = result.PName;
                var PNo = result.PNo;
                var PClass = $('#PClass').textbox('getValue');
                if (!PClass) {
                    PClass = result.PClass;
                }
                var PBankNo = $('#PBankNo').textbox('getValue');
                if (!PBankNo) {
                    PBankNo = result.PBankNo;
                }
                var PPhone = $('#PPhone').textbox('getValue');
                if (!PPhone) {
                    PPhone = result.PPhone;
                }
                var PQQ = $('#PQQ').textbox('getValue');
                if (!PQQ) {
                    PQQ = result.PQQ;
                }
                var PWechat = $('#PWechat').textbox('getValue');
                if (!PWechat) {
                    PWechat = result.PWechat;
                }
                var PHdu = $('#PHdu').textbox('getValue');
                if (!PHdu) {
                    PHdu = result.PHdu;
                }
                var PT_Size = $('#PT_Size').textbox('getValue');
                if (!PT_Size) {
                    PT_Size = result.PT_Size;
                }
                $.ajax({
                    type: "post",
                    async: false,
                    url: './EditPerson.php',
                    data: {
                        'PNo': PNo,
                        'PName': PName,
                        'PClass': PClass,
                        'PBankNo': PBankNo,
                        'PPhone': PPhone,
                        'PQQ': PQQ,
                        'PWechat': PWechat,
                        'PT_Size': PT_Size,
                        'PHdu': PHdu,
                    },
                    success: function (data) {
                        result = data;
                    }
                });
                if (result != true) {
                    alert(result);
                } else {
                    alert("修改成功！");
                }
                //刷新信息
                $('#panelC').panel('clear');
                window.onload = getInfo();
            });

    })
    window.onload = getInfo();
</script>
</body>
</html>
